# Config ArcFace Training cho Kaggle
# Toi uu hoa cho GPU 16GB (P100/T4) voi nhieu classes (9000+)

# Model Architecture
model:
  backbone: resnet50
  embedding_size: 512
  pretrained: true
  freeze_ratio: 0.0 # KHONG dong bang - can train full backbone

# ArcFace Loss - DIEU CHINH CHO NHIEU CLASSES
arcface:
  margin: 0.1 # Giam manh tu 0.35 - bat dau nho roi tang dan
  scale: 64.0 # Tang tu 30 len 64 (gia tri paper goc)
  easy_margin: true # Bat easy_margin de de hoi tu hon

# Training Configuration - toi uu cho Kaggle
training:
  num_epochs: 50
  batch_size: 128
  num_workers: 4

  warmup:
    enabled: false # Tat warmup khi resume
    epochs: 5
    start_lr: 0.00001

  optimizer:
    type: sgd
    lr: 0.0005
    momentum: 0.9
    weight_decay: 0.0005

  scheduler:
    type: step
    step_size: 20 # Giam LR moi 20 epochs
    gamma: 0.5 # Giam nhe hon (0.5 thay vi 0.1)
    eta_min: 0.0001 # Khong giam duoi 1e-04

  grad_clip:
    enabled: true
    max_norm: 5.0

  early_stopping:
    enabled: true
    patience: 9
    min_delta: 0.0001

  # Label Smoothing - giam overfitting
  label_smoothing: 0.1

# Data Configuration
data:
  mode: folder # Khong can CSV metadata

  # Paths (se bi override boi --data_dir)
  train_data_root: data/train
  val_data_root: data/val

  # CSV paths (chi dung khi mode: csv)
  train_csv: data/metadata/train_labels.csv
  val_csv: data/metadata/val_labels.csv

  min_images_per_identity: 5
  class_balanced_sampling: true
  augment_strength: strong
  image_size: 112

  normalize:
    mean: [0.5, 0.5, 0.5]
    std: [0.5, 0.5, 0.5]

# Checkpointing
checkpoint:
  save_dir: /kaggle/working/checkpoints/arcface
  save_best: true
  save_interval: 1
  keep_last_n: 2 # Giam de tiet kiem dung luong

# Logging
logging:
  use_tensorboard: false # Tat TensorBoard tren Kaggle
  log_dir: /kaggle/working/logs/arcface
  log_interval: 50

  embedding_vis:
    enabled: false # Tat t-SNE de tiet kiem thoi gian

# Device
device: cuda

# Mixed Precision - bat de tang toc
mixed_precision:
  enabled: true
