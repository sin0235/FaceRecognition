# Config ArcFace Training cho Kaggle
# Toi uu hoa cho GPU 16GB (P100/T4)

# Model Architecture
model:
  backbone: resnet50
  embedding_size: 512
  pretrained: true
  freeze_ratio: 0.8

# ArcFace Loss
arcface:
  margin: 0.35
  scale: 30.0
  easy_margin: false

# Training Configuration - toi uu cho Kaggle
training:
  num_epochs: 30
  batch_size: 64          # Giam tu 256 de fit GPU 16GB
  num_workers: 2          # Kaggle gioi han workers
  
  warmup:
    enabled: true
    epochs: 3
    start_lr: 0.0001
  
  optimizer:
    type: sgd
    lr: 0.01              # Tang LR vi batch_size nho hon
    momentum: 0.9
    weight_decay: 0.0005
  
  scheduler:
    type: cosine
    eta_min: 0.00001
  
  grad_clip:
    enabled: true
    max_norm: 5.0
  
  early_stopping:
    enabled: true
    patience: 7
    min_delta: 0.001

# Data Configuration
data:
  mode: folder            # Khong can CSV metadata
  
  # Paths (se bi override boi --data_dir)
  train_data_root: data/train
  val_data_root: data/val
  
  # CSV paths (chi dung khi mode: csv)
  train_csv: data/metadata/train_labels.csv
  val_csv: data/metadata/val_labels.csv
  
  min_images_per_identity: 5
  class_balanced_sampling: true
  augment_strength: normal
  image_size: 112
  
  normalize:
    mean: [0.5, 0.5, 0.5]
    std: [0.5, 0.5, 0.5]

# Checkpointing
checkpoint:
  save_dir: /kaggle/working/checkpoints/arcface
  save_best: true
  save_interval: 1
  keep_last_n: 2          # Giam de tiet kiem dung luong

# Logging
logging:
  use_tensorboard: false  # Tat TensorBoard tren Kaggle
  log_dir: /kaggle/working/logs/arcface
  log_interval: 50
  
  embedding_vis:
    enabled: false        # Tat t-SNE de tiet kiem thoi gian

# Device
device: cuda

# Mixed Precision - bat de tang toc
mixed_precision:
  enabled: true
