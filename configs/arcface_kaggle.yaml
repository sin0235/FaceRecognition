# Config ArcFace Training cho Kaggle
# Dataset: CelebA_Aligned_Balanced - 9343 classes, ~18 images/class
# Toi uu cho dataset nho voi nhieu classes

# Model Architecture
model:
  backbone: resnet50
  embedding_size: 512
  pretrained: true
  freeze_ratio: 0.0 # Train full backbone

# ArcFace Loss - DIEU CHINH CHO DATASET NHO
arcface:
  margin: 0.25 # Giam xuong 0.2 de de hoi tu voi it data/class
  scale: 30.0 # Giam xuong 30 de on dinh hon (paper dung 64 voi 5.8M images)
  easy_margin: true # Giu easy_margin de de hoi tu

# Training Configuration - toi uu cho dataset nho
training:
  num_epochs: 100 # Tang len 100 vi LR thap hon can nhieu epochs
  batch_size: 128
  num_workers: 8

  warmup:
    enabled: true
    epochs: 10 # Tang len 10 epochs de on dinh hon
    start_lr: 0.0001 # Bat dau cao hon de warmup smooth

  optimizer:
    type: sgd
    lr: 0.0075 # GIAM TU 0.1 XUONG 0.01 - phu hop dataset nho
    momentum: 0.9
    weight_decay: 0.0005 # Giam weight_decay de tranh underfitting

  scheduler:
    type: cosine # Cosine smooth hon step, tot cho dataset nho
    step_size: 20 # Backup neu dung step
    gamma: 0.1
    eta_min: 0.00001

  grad_clip:
    enabled: true
    max_norm: 5.0

  early_stopping:
    enabled: true
    patience: 20 # Tang patience vi cosine scheduler giam cham
    min_delta: 0.0001

# Data Configuration
data:
  mode: folder # Khong can CSV metadata

  # Paths (se bi override boi --data_dir)
  train_data_root: data/train
  val_data_root: data/val

  # CSV paths (chi dung khi mode: csv)
  train_csv: data/metadata/train_labels.csv
  val_csv: data/metadata/val_labels.csv

  min_images_per_identity: 5
  class_balanced_sampling: true
  augment_strength: heavy # heavy cho dataset it anh/class, tang variety
  image_size: 112

  normalize:
    mean: [0.5, 0.5, 0.5]
    std: [0.5, 0.5, 0.5]

# Checkpointing
checkpoint:
  save_dir: /kaggle/working/checkpoints/arcface
  save_best: true
  save_interval: 1
  keep_last_n: 2 # Giam de tiet kiem dung luong

# Logging
logging:
  use_tensorboard: false # Tat TensorBoard tren Kaggle
  log_dir: /kaggle/working/logs/arcface
  log_interval: 50

  embedding_vis:
    enabled: false # Tat t-SNE de tiet kiem thoi gian

# Device
device: cuda

# Mixed Precision - bat de tang toc
mixed_precision:
  enabled: true
